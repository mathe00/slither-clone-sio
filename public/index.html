<!-- --- public/index.html --- -->
<!--
 * ==============================================================================
 * FILE: index.html
 *
 * DESCRIPTION:
 * Main entry point for the Slither Clone SIO game. Sets up the HTML structure,
 * includes the primary WebGL canvas and the 2D text overlay canvas, defines UI
 * containers for the start menu, game over screen, leaderboard, notifications,
 * admin link, ghost mode elements, and HUD displays. Loads all necessary CSS
 * stylesheets and JavaScript modules in the correct order. Includes Service Worker
 * registration and initial server connection check logic.
 *
 * DEVELOPER GUIDELINES:
 * - Use semantic HTML5 elements where appropriate.
 * - Keep the structure clean and well-indented.
 * - Ensure accessibility attributes (alt text, ARIA roles if needed) are considered.
 * - Maintain and update comments when significantly changing the structure.
 * - Pay attention to the script loading order (defer attribute).
 * ==============================================================================
-->

<!doctype html>
<html lang="en">
  <!-- Lang attribute might be updated by i18next detector -->
  <head>
    <meta charset="UTF-8" />
    <title data-i18n="mainPage.title">Slither Clone SIO</title>
    <link rel="icon" href="slither-logo.png" type="image/x-icon" />
    <!-- Main Styles (Menu, Base, Offline Fallback) -->
    <link rel="stylesheet" href="styles.css" />
    <!-- Leaderboard Specific Styles -->
    <link rel="stylesheet" href="styles-leaderboard.css" />
    <!-- Game Specific Styles (Canvas, Overlays, etc.) -->
    <link rel="stylesheet" href="styles-game.css" />
    <script>
      // Service Worker Registration
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker
            .register('/service-worker.js')
            .then(registration => console.log('Service Worker registered'))
            .catch(error => console.error('Registration error:', error));
        });
      }

      // --- Server Connection Check (Initial Load Only) ---
      function checkInitialServerConnection() {
        fetch('/')
          .then(response => {
            if (!response.ok) {
              console.warn(`Initial server check failed: Status ${response.status}`);
              // Redirect only if not already on offline page
              if (window.location.pathname !== '/offline.html') {
                window.location.href = '/offline.html';
              }
            } else {
              console.log('Initial server check: OK');
            }
          })
          .catch(error => {
            console.error('Initial server check failed (Network Error):', error);
            // Redirect only if not already on offline page
            if (window.location.pathname !== '/offline.html') {
              window.location.href = '/offline.html';
            }
          });
      }
      checkInitialServerConnection();
      // --- End Initial Server Connection Check ---
    </script>
  </head>
  <body>
    <!-- Body class will be toggled for fullscreen mode -->
    <div id="gameContainer">
      <!-- REMOVED width and height attributes -->
      <canvas id="gameCanvas"></canvas>
      <canvas
        id="textOverlayCanvas"
        style="
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          pointer-events: none;
          z-index: 2;
        "
      ></canvas>
      <!-- Minimap Canvas -->
      <canvas
        id="minimapCanvas"
        style="
          position: absolute;
          bottom: 15px;
          left: 15px;
          width: 150px;
          height: 150px;
          border: 1px solid rgba(204, 204, 204, 0.5);
          background-color: rgba(51, 51, 51, 0.7);
          z-index: 3;
          display: none;
        "
      ></canvas>
      <!-- End Minimap Element -->
      <div id="gameOverOverlay">
        <!-- Content generated by ui-logic.js -->
        <div id="gameOverText"></div>
        <div class="game-over-buttons">
          <button id="replayButton" data-i18n="gameOver.replayButton">Replay</button>
          <button id="backToMenuButton" data-i18n="gameOver.backToMenuButton">Back to Menu</button>
        </div>
      </div>
      <!-- Class 'leaderboard-is-hidden' added/removed by JS -->
      <!-- Leaderboard Panel (Moved outside start-menu-content) -->
      <div id="leaderboard" class="leaderboard-panel">
        <!-- Button to HIDE (on the panel) -->
        <button
          id="leaderboardToggleBtn"
          class="leaderboard-toggle-btn"
          data-i18n="[title]leaderboard.hideButtonTitle"
          title="Hide Leaderboard"
        >
          <span class="arrow right"></span>
        </button>
        <h3 data-i18n="leaderboard.title">Leaderboard</h3>
        <table id="leaderboardTable">
          <thead>
            <tr>
              <th data-i18n="leaderboard.header.name">Name</th>
              <th data-i18n="leaderboard.header.status">Status</th>
              <th data-i18n="leaderboard.header.size">Size</th>
              <th data-i18n="leaderboard.header.kills">Kills</th>
              <th data-i18n="leaderboard.header.deaths">Deaths</th>
              <th data-i18n="leaderboard.header.kd">K/D</th>
            </tr>
          </thead>
          <tbody id="leaderboardContent">
            <!-- Initial message if empty -->
            <tr data-i18n-parent>
              <td colspan="6" class="leaderboard-message" data-i18n="leaderboard.noPlayers">
                No players ranked yet.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div id="startMenuOverlay">
        <!-- Inner container for centering -->
        <div id="menu-inner-container">
          <!-- Welcome message displayed if logged in -->
          <div id="welcomeMessage" class="welcome-message"></div>
          <h2 class="main-title" data-i18n="[html]mainMenu.title">
            Welcome to <span class="blink">Slither Clone SIO</span>
          </h2>
          <!-- Mode Selector -->
          <div id="modeSelector" class="modeSelector active">
            <button id="tempModeBtn" tabindex="0" data-i18n="ui.buttons.playGuest">
              Play as Guest
            </button>
            <button
              id="loginModeBtn"
              class="auth-required"
              tabindex="0"
              data-i18n="ui.buttons.login"
            >
              Login
            </button>
            <button
              id="createModeBtn"
              class="auth-required"
              tabindex="0"
              data-i18n="ui.buttons.createAccount"
            >
              Create Account
            </button>
            <button
              id="skinModeBtn"
              class="skin-btn"
              tabindex="0"
              data-i18n="ui.buttons.customizeSkin"
            >
              Customize Appearance
            </button>
            <button
              id="customSoundsBtn"
              class="custom-sounds-btn"
              tabindex="0"
              data-i18n="ui.buttons.customSounds"
            >
              Custom Sounds
            </button>
            <button
              id="showLeaderboardBtn"
              class="show-leaderboard-btn"
              tabindex="0"
              data-i18n="ui.buttons.showLeaderboard"
            >
              Show Leaderboard
            </button>
            <button
              id="ghostModeBtn"
              class="ghost-mode-btn"
              tabindex="0"
              data-i18n="ui.buttons.ghostMode"
            >
              Ghost Mode
            </button>
            <button
              id="deleteAccountBtn"
              class="delete-account-btn"
              tabindex="0"
              data-i18n="ui.buttons.deleteAccount"
            >
              Delete My Account
            </button>
            <button id="logoutBtn" class="logout-btn" tabindex="0" data-i18n="ui.buttons.logout">
              Logout
            </button>
          </div>
          <!-- Temporary Form -->
          <div id="tempForm" class="modeForm">
            <h3 data-i18n="forms.guest.title">Play as Guest</h3>
            <p class="form-note" data-i18n="forms.guest.note">
              Colors and skin will be set via "Customize Appearance".
            </p>
            <div class="form-buttons">
              <button id="startButton" tabindex="0" data-i18n="forms.guest.submitButton">
                Start Game
              </button>
              <button
                id="backModeBtn1"
                class="back-button"
                tabindex="0"
                data-i18n="forms.common.backButton"
              >
                Back
              </button>
            </div>
          </div>
          <!-- Login Form -->
          <form id="loginForm" class="modeForm" onsubmit="return false;">
            <h3 data-i18n="forms.login.title">Login</h3>
            <label>
              <span data-i18n="forms.common.usernameLabel">Username:</span>
              <input
                type="text"
                id="loginUsernameInput"
                name="username"
                autocomplete="username"
                maxlength="15"
                tabindex="0"
              />
            </label>
            <label>
              <span data-i18n="forms.common.passwordLabel">Password:</span>
              <input
                type="password"
                id="loginPasswordInput"
                name="password"
                autocomplete="current-password"
                tabindex="0"
              />
            </label>
            <div class="form-buttons">
              <button id="loginButton" tabindex="0" data-i18n="forms.login.submitButton">
                Login
              </button>
              <button
                id="backModeBtn2"
                class="back-button"
                tabindex="0"
                data-i18n="forms.common.backButton"
              >
                Back
              </button>
            </div>
          </form>
          <!-- Create Account Form -->
          <form id="createForm" class="modeForm" onsubmit="return false;">
            <h3 data-i18n="forms.create.title">Create Account</h3>
            <label>
              <span data-i18n="forms.common.usernameLabel">Username:</span>
              <input
                type="text"
                id="createUsernameInput"
                name="username"
                autocomplete="username"
                maxlength="15"
                tabindex="0"
              />
            </label>
            <label>
              <span data-i18n="forms.common.passwordLabel">Password:</span>
              <input
                type="password"
                id="createPasswordInput"
                name="password"
                autocomplete="new-password"
                tabindex="0"
              />
            </label>
            <label>
              <span data-i18n="forms.create.initialHeadColorLabel">Initial Head Color:</span>
              <input type="color" id="createHeadColorInput" value="#ff0000" tabindex="0" />
            </label>
            <label>
              <span data-i18n="forms.create.initialBodyColorLabel">Initial Body Color:</span>
              <input type="color" id="createBodyColorInput" value="#ffff00" tabindex="0" />
            </label>
            <div class="form-buttons">
              <button id="createButton" tabindex="0" data-i18n="forms.create.submitButton">
                Create
              </button>
              <button
                id="backModeBtn3"
                class="back-button"
                tabindex="0"
                data-i18n="forms.common.backButton"
              >
                Back
              </button>
            </div>
          </form>
          <!-- Skin Form -->
          <div id="skinForm" class="modeForm">
            <h3 data-i18n="forms.skin.title">Customize Appearance</h3>
            <div class="skin-section">
              <label>
                <span data-i18n="forms.skin.headColorLabel">Head Color:</span>
                <input type="color" id="skinHeadColorInput" value="#ff0000" tabindex="0" />
              </label>
            </div>
            <div class="skin-section">
              <h4 data-i18n="forms.skin.bodyTypeLabel">Body Type</h4>
              <div class="radio-group">
                <label>
                  <input type="radio" name="bodyType" value="single" checked tabindex="0" />
                  <span data-i18n="forms.skin.bodyTypeSingle">Single Color</span>
                </label>
                <label>
                  <input type="radio" name="bodyType" value="pattern" tabindex="0" />
                  <span data-i18n="forms.skin.bodyTypePattern">Repeating Pattern</span>
                </label>
              </div>
            </div>
            <div id="skinSingleColorSection" class="skin-section">
              <label>
                <span data-i18n="forms.skin.bodyColorLabel">Body Color:</span>
                <input type="color" id="skinBodyColorInput" value="#ffff00" tabindex="0" />
              </label>
            </div>
            <div id="skinPatternSection" class="skin-section" style="display: none">
              <h4 data-i18n="forms.skin.patternColorsLabel">Pattern Colors (max 8)</h4>
              <div id="patternColorPickers">
                <!-- Color pickers will be added here by JS -->
              </div>
              <button id="addPatternColorBtn" class="small-btn" tabindex="0">+</button>
              <button id="removePatternColorBtn" class="small-btn" tabindex="0">-</button>
            </div>
            <div class="skin-section">
              <h4 data-i18n="forms.skin.trailEffectLabel">Trail Effect</h4>
              <select id="trailEffectSelect" tabindex="0">
                <option value="none" data-i18n="forms.skin.trailEffect.none">None</option>
                <option value="sparkle" data-i18n="forms.skin.trailEffect.sparkle">Sparkle</option>
                <option value="smoke" data-i18n="forms.skin.trailEffect.smoke">Green Smoke</option>
                <option value="fire" data-i18n="forms.skin.trailEffect.fire">Fire</option>
                <option value="ice" data-i18n="forms.skin.trailEffect.ice">Ice Shards</option>
                <option value="electric" data-i18n="forms.skin.trailEffect.electric">
                  Electric Sparks
                </option>
                <option value="rainbow" data-i18n="forms.skin.trailEffect.rainbow">Rainbow</option>
                <option value="bubbles" data-i18n="forms.skin.trailEffect.bubbles">Bubbles</option>
                <option value="glitch" data-i18n="forms.skin.trailEffect.glitch">Glitch</option>
                <option value="void" data-i18n="forms.skin.trailEffect.void">Void / Shadow</option>
                <option value="confetti" data-i18n="forms.skin.trailEffect.confetti">
                  Confetti
                </option>
              </select>
            </div>
            <div class="form-buttons">
              <button id="saveSkinButton" tabindex="0" data-i18n="forms.skin.submitButton">
                Save Appearance
              </button>
              <button
                id="backModeBtn6"
                class="back-button"
                tabindex="0"
                data-i18n="forms.common.backButton"
              >
                Back
              </button>
            </div>
          </div>
          <!-- Sound Form -->
          <div id="soundForm" class="modeForm">
            <h3 data-i18n="forms.sound.title">Custom Sounds</h3>
            <p class="sound-info" data-i18n="forms.sound.info">
              Upload MP3 files (stored locally) for events.
            </p>
            <div class="sound-upload-group">
              <label for="deathSoundInput" data-i18n="forms.sound.deathLabel">Death Sound:</label>
              <input
                type="file"
                id="deathSoundInput"
                accept=".mp3"
                data-event-type="death"
                tabindex="0"
              />
              <span class="sound-status" id="deathSoundStatus"></span>
            </div>
            <div class="sound-upload-group">
              <label for="killSoundInput" data-i18n="forms.sound.killLabel">Kill Sound:</label>
              <input
                type="file"
                id="killSoundInput"
                accept=".mp3"
                data-event-type="kill"
                tabindex="0"
              />
              <span class="sound-status" id="killSoundStatus"></span>
            </div>
            <div class="sound-upload-group">
              <label for="boostSoundInput" data-i18n="forms.sound.boostLabel">Boost Sound:</label>
              <input
                type="file"
                id="boostSoundInput"
                accept=".mp3"
                data-event-type="boost"
                tabindex="0"
              />
              <span class="sound-status" id="boostSoundStatus"></span>
            </div>
            <div class="form-buttons">
              <button id="clearSoundsButton" tabindex="0" data-i18n="forms.sound.clearButton">
                Clear Sounds
              </button>
              <button
                id="backModeBtn4"
                class="back-button"
                tabindex="0"
                data-i18n="forms.common.backButton"
              >
                Back
              </button>
            </div>
          </div>
        </div>
        <!-- End of #menu-inner-container -->
        <button
          id="creditsHelpBtn"
          class="credits-help-btn"
          data-i18n="[title]mainMenu.helpButtonTitle"
          title="Help & Credits"
        >
          ?
        </button>
        <div id="creditsHelpPanel" class="credits-help-panel">
          <button id="closeCreditsHelpBtn" class="close-credits-help-btn">&times;</button>
          <h4 data-i18n="helpPanel.menuKeysTitle">Keyboard Shortcuts (Menu)</h4>
          <ul>
            <li data-i18n="helpPanel.menuKeys.navigate">↑ / ↓ / Tab: Navigate buttons</li>
            <li data-i18n="helpPanel.menuKeys.activate">Enter: Activate selected button</li>
            <li data-i18n="helpPanel.menuKeys.close">Esc: Close this panel / Go Back</li>
          </ul>
          <h4 data-i18n="helpPanel.gameKeysTitle">Keyboard Shortcuts (Game)</h4>
          <ul>
            <li data-i18n="helpPanel.gameKeys.mouse">Mouse: Steer snake</li>
            <li data-i18n="helpPanel.gameKeys.boost">Left Click / Space: Boost</li>
            <li data-i18n="helpPanel.gameKeys.adminCheat">P: Admin Cheat (if admin)</li>
          </ul>
          <h4 data-i18n="helpPanel.ghostKeysTitle">Keyboard Shortcuts (Ghost)</h4>
          <ul>
            <li data-i18n="helpPanel.ghostKeys.select">Left Click (on player): Select Player</li>
            <li data-i18n="helpPanel.ghostKeys.pan">Left Click + Drag (empty space): Pan Camera</li>
            <li data-i18n="helpPanel.ghostKeys.zoom">Mouse Wheel: Zoom In/Out</li>
            <li data-i18n="helpPanel.ghostKeys.kill">K (if player selected): Kill Player</li>
            <li data-i18n="helpPanel.ghostKeys.clear">
              C (if player selected): Clear Player (no food)
            </li>
            <li data-i18n="helpPanel.ghostKeys.freeze">
              F (if player selected): Freeze/Unfreeze Player
            </li>
            <li data-i18n="helpPanel.ghostKeys.deselect">Esc: Deselect Player</li>
          </ul>
          <hr />
          <h4 data-i18n="helpPanel.creditsTitle">Credits</h4>
          <p>Slither Clone SIO - 2025</p>
          <p data-i18n="helpPanel.creditsAuthor">Author: Anonymous Author</p>
          <p data-i18n="helpPanel.creditsLicense">License: MIT</p>
          <p>
            <a
              href="https://github.com/anonymous/slither-clone-sio"
              target="_blank"
              rel="noopener noreferrer"
              data-i18n="helpPanel.creditsGithub"
              >Project on GitHub</a
            >
          </p>
        </div>
      </div>
      <!-- End of #startMenuOverlay -->
      <div id="adminMessageOverlay"></div>
      <a id="adminLink" href="/admin" style="display: none" data-i18n="mainMenu.adminLink">Admin</a>
      <button
        id="exitGhostButton"
        class="exit-ghost-btn"
        style="display: none"
        data-i18n="mainMenu.exitGhostButton"
      >
        Exit Ghost Mode
      </button>
      <div id="ghostShortcutGuide" style="display: none"></div>
    </div>
    <div id="snakeSizeDisplay"></div>
    <!-- Moved outside canvas for positioning -->
    <div id="snakePositionDisplay"></div>
    <!-- Added for position display -->
    <div id="notificationContainer"></div>
    <!-- Container for connect/disconnect notifications -->

    <!-- i18next libraries (Load before other scripts) -->
    <script src="https://unpkg.com/i18next/i18next.min.js"></script>
    <script src="https://unpkg.com/i18next-http-backend/i18nextHttpBackend.min.js"></script>
    <script src="https://unpkg.com/i18next-browser-languagedetector/i18nextBrowserLanguageDetector.min.js"></script>

    <!-- Game Scripts (Load after libraries) -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="webgl-utils.js" defer></script>
    <script src="game-renderer.js" defer></script>
    <script src="game-main.js" defer></script>
    <script src="trail-effects.js" defer></script>
    <script src="sound-manager.js" defer></script>
    <script src="ui-logic.js" defer></script>
    <!-- ui-logic initializes i18next -->
  </body>
</html>
